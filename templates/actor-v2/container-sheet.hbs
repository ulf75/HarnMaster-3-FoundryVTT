<form
    class="{{ cssClass }} sheet flexcol"
    autocomplete="off">
    {{!-- Sheet Header --}}
    <header class="sheet-header sheet-header-character">
        <div class="flexrow">
            {{> char_v2_img_partial cls='profile-img' src=aproxy.img edit='img' h=100 w=100}}
            <div class="flexcol header-fields">
                <div class="flexrow name-attribute">
                    <h1 class="charname">
                        <input
                            name="name"
                            type="text"
                            value="{{ aproxy.name }}"
                            placeholder="Name" />
                    </h1>
                    <div class="header-stat-block">
                        <div class="penalties flexrow">
                            <div class="capacity-label">Max Capacity</div>
                            <input
                                class="capacity-value"
                                type="number"
                                name="system.capacity.max"
                                value="{{ aproxy.capacity.max }}"
                                data-dtype="Number" />
                        </div>
                        <div class="endurance flexrow">
                            <span class="label">Contents Wt.: {{ aproxy.capacity.value }}</span>
                        </div>
                        <div class="endbar">
                            <span
                                class="bar"
                                style="width: {{ aproxy.capacity.pct }}%"></span>
                        </div>
                    </div>
                </div>
                <div class="header-attributes"></div>
            </div>
        </div>
    </header>

    {{!-- Sheet Tab Navigation --}}
    <nav
        class="sheet-tabs sheet-tabs-v2 tabs"
        data-group="primary">
        <a
            class="item"
            data-tab="facade">
            Fa&#231;ade
        </a>
        <a
            class="item"
            data-tab="inventory">
            Contents
        </a>
    </nav>

    {{!-- Sheet Body --}}
    <section class="sheet-body sheet-body-v2">
        {{!-- Facade Tab --}}
        <div
            class="tab facade"
            data-group="primary"
            data-tab="facade">
            <div class="flexrow">
                {{> char_v2_img_partial cls='facade-image' src=aproxy.bioImage edit='system.bioImage' h=300 w=200}}
                <div class="facade-description">
                    {{editor descriptionHTML target="system.description" button=true engine="prosemirror" owner=owner editable=editable}}
                </div>
            </div>
        </div>

        {{!-- Contents Tab --}}
        <div
            class="tab inventory items"
            data-group="primary"
            data-tab="inventory">
            <div class="flexrow">
                <ol class="weight flexcol">
                    <li class="weight-header flexrow">
                        <div class="weight-detail title"></div>
                        <div class="weight-detail weapon">Weapon</div>
                        <div class="weight-detail missile">Missile</div>
                        <div class="weight-detail armor">Armor</div>
                        <div class="weight-detail misc-gear">Misc. Gear</div>
                        <div class="total">Total</div>
                    </li>
                    <li class="weight-line flexrow">
                        <div class="weight-detail title">Weight</div>
                        <div class="weight-detail weapon">{{ aproxy.totalWeaponWeight }}</div>
                        <div class="weight-detail missile">{{ aproxy.totalMissileWeight }}</div>
                        <div class="weight-detail armor">{{ aproxy.totalArmorWeight }}</div>
                        <div class="weight-detail misc-gear">{{ aproxy.totalMiscGearWeight }}</div>
                        <div class="total">{{ aproxy.totalGearWeight }}</div>
                    </li>
                </ol>
                <div class="buf"></div>
            </div>

            <!-- Gear -->
            <div class="flexrow">
                <input
                    class="gear-name-filter"
                    type="text"
                    name="system.gearNameFilter"
                    placeholder="Filter gear by name..."
                    data-dtype="String" />
            </div>
            {{#each aproxy.containers as |citem cid|}}
            <ol class="items-list gear-list">
                <li
                    class="items-header gear flexrow"
                    data-container-id="{{ cid }}"
                    data-container-name="{{ citem.name }}">
                    <div class="citem-controls">
                        {{#if citem.collapsed}}
                        <a
                            class="item-control item-maximize active"
                            aria-label="Maximize"
                            data-tooltip="Maximize"
                            data-tooltip-direction="UP"
                            data-action="maximize"
                            data-cuuid="{{ citem.uuid }}"
                            data-container-id="{{ cid }}"
                            data-container-name="{{ citem.name }}"
                            data-type="gear">
                            <i class="fas fa-plus"></i>
                        </a>
                        {{else}}
                        <a
                            class="item-control item-minimize active"
                            aria-label="Minimize"
                            data-tooltip="Minimize"
                            data-tooltip-direction="UP"
                            data-action="minimize"
                            data-cuuid="{{ citem.uuid }}"
                            data-container-id="{{ cid }}"
                            data-container-name="{{ citem.name }}"
                            data-type="gear">
                            <i class="fas fa-minus"></i>
                        </a>
                        {{/if}}
                    </div>
                    <h3 class="item-name gear-name-h">
                        {{ citem.name }}
                        <a
                            class="more-info"
                            data-journal-entry="Sheet - Gear Tab">
                            <i class="far fa-question-circle"></i>
                        </a>
                    </h3>
                    <div class="item-detail gear-type">Type</div>
                    <div class="item-detail gear-qty">Qty</div>
                    <div class="item-detail gear-weight">Weight</div>
                    <div class="item-detail gear-notes">Notes</div>
                    {{#unless (eq citem.subtype "Group")}}
                    <div class="item detail gear-capacity {{#if (gt citem.capacity.value citem.capacity.max)}}overcapacity{{/if}}">
                        Capacity: {{ citem.capacity.value }}/{{ citem.capacity.max }}
                    </div>
                    {{/unless}}
                    <div class="item-controls">
                        <a
                            class="item-control item-create active"
                            aria-label="Add Gear"
                            data-tooltip="Add Gear"
                            data-tooltip-direction="UP"
                            data-type="gear"
                            data-container-id="{{ cid }}"
                            data-container-name="{{ citem.name }}">
                            <i class="fas fa-plus"></i>
                            Add
                        </a>
                    </div>
                </li>
                <ol class="item-list gear-list">
                    {{#each ../items as | item |}}
                    {{#if (and (endswith item.type "gear") (eq item.container cid))}}
                    {{#unless citem.collapsed}}
                    <li
                        class="item gear-item {{#unless item.isCarried}}nocarry{{/unless}} flexrow"
                        data-item-id="{{ item.id }}"
                        data-item-name="{{ item.name }}"
                        data-container-id="{{ cid }}"
                        data-container-name="{{ citem.name }}">
                        <div class="citem-controls-0 flexrow"></div>
                        <div class="item-name gear-name flexrow">
                            <div
                                class="item-image"
                                style="background-image: url('{{ item.img }}')"></div>
                            <h4>{{ item.name }}</h4>
                        </div>
                        <div class="item-detail gear-type">{{ item.label }}</div>
                        <div class="item-detail gear-qty">
                            <input type="text" {{#unless item.isCarried}}class="nocarry"{{/unless}} name="item-quantity-special" id="{{
                                item.id
                            }}" value="{{ item.quantity }}" data-dtype="Number"/>
                        </div>
                        <div class="item-detail gear-weight">{{ item.weightT }}</div>
                        <div class="item-detail gear-notes">{{ item.notes }}</div>
                        <div class="item-controls-wide">
                            {{#if (or (eq cid "on-person") (eq citem.subtype "Group"))}}
                            {{#unless (or (eq item.type "containergear") (eq item.type "miscgear"))}}
                            <a
                                class="item-control item-equip"
                                aria-label="{{ item.ariaLabelEquip }}"
                                data-tooltip="{{ item.ariaLabelEquip }}"
                                data-tooltip-direction="UP">
                                <i class="{{#if item.isEquipped}}active{{/if}} fas fa-shield-alt"></i>
                            </a>
                            {{/unless}}
                            <a
                                class="item-control item-carry"
                                aria-label="{{ ariaLabelCarry }}"
                                data-tooltip="{{ ariaLabelCarry }}"
                                data-tooltip-direction="UP">
                                <i class="{{#if item.isCarried}}active{{/if}} fas fa-suitcase"></i>
                            </a>
                            {{/if}}
                            <a
                                class="item-control item-edit"
                                aria-label="Edit {{ name }}"
                                data-tooltip="Edit {{ name }}"
                                data-tooltip-direction="UP">
                                <i class="active fas fa-edit"></i>
                            </a>
                            <a
                                class="item-control item-delete"
                                aria-label="Delete {{ name }}"
                                data-tooltip="Delete {{ name }}"
                                data-tooltip-direction="UP"
                                data-label="{{ item.name }} ({{ item.label }})">
                                <i class="active fas fa-trash"></i>
                            </a>
                        </div>
                    </li>
                    {{/unless}}
                    {{/if}}
                    {{/each}}
                </ol>
            </ol>
            {{/each}}
        </div>
    </section>
</form>
