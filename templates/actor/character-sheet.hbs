{{#> char_layout_partial chartype='Character' }}

{{!-- Profile Tab --}}
<div class="tab profile" data-group="primary" data-tab="profile">
    <div class="flexcol">
        <ul class="flexrow ability-scores">
            <li class="ability" data-ability="strength">
                <h4 class="ability-name box-title rollable">Strength</h4>
                <h3 class="ability-value">{{ adata.abilities.strength.effective }}</h3>
                <div class="ability-modifiers flexrow">
                    <div class="item-dice">
                        <a class="ability-d6-roll" data-ability="strength" title="d6 Strength Roll">
                            <i class="fas fa-dice-d6"></i>
                        </a>
                    </div>
                    <div class="ability-box">
                        <input
                            class="ability-base"
                            type="number"
                            name="system.abilities.strength.base"
                            value="{{ adata.abilities.strength.base }}"
                            data-dtype="Number" />
                    </div>
                    <div class="item-dice">
                        <a class="ability-d100-roll" data-ability="strength" title="d100 Strength Roll">
                            <i class="fas fa-dice-d20"></i>
                        </a>
                    </div>
                </div>
            </li>
            <li class="ability" data-ability="stamina">
                <h4 class="ability-name box-title rollable">Stamina</h4>
                <h3 class="ability-value">{{ adata.abilities.stamina.effective }}</h3>
                <div class="ability-modifiers flexrow">
                    <div class="item-dice">
                        <a class="ability-d6-roll" data-ability="stamina" title="d6 Stamina Roll">
                            <i class="fas fa-dice-d6"></i>
                        </a>
                    </div>
                    <div class="ability-box">
                        <input
                            class="ability-base"
                            type="number"
                            name="system.abilities.stamina.base"
                            value="{{ adata.abilities.stamina.base }}"
                            data-dtype="Number" />
                    </div>
                    <div class="item-dice">
                        <a class="ability-d100-roll" data-ability="stamina" title="d100 Stamina Roll">
                            <i class="fas fa-dice-d20"></i>
                        </a>
                    </div>
                </div>
            </li>
            <li class="ability" data-ability="dexterity">
                <h4 class="ability-name box-title rollable">Dexterity</h4>
                <h3 class="ability-value">{{ adata.abilities.dexterity.effective }}</h3>
                <div class="ability-modifiers flexrow">
                    <div class="item-dice">
                        <a class="ability-d6-roll" data-ability="dexterity" title="d6 Dexterity Roll">
                            <i class="fas fa-dice-d6"></i>
                        </a>
                    </div>
                    <div class="ability-box">
                        <input
                            class="ability-base"
                            type="number"
                            name="system.abilities.dexterity.base"
                            value="{{ adata.abilities.dexterity.base }}"
                            data-dtype="Number" />
                    </div>
                    <div class="item-dice">
                        <a class="ability-d100-roll" data-ability="dexterity" title="d100 Dexterity Roll">
                            <i class="fas fa-dice-d20"></i>
                        </a>
                    </div>
                </div>
            </li>
            <li class="ability" data-ability="agility">
                <h4 class="ability-name box-title rollable">Agility</h4>
                <h3 class="ability-value">{{ adata.abilities.agility.effective }}</h3>
                <div class="ability-modifiers flexrow">
                    <div class="item-dice">
                        <a class="ability-d6-roll" data-ability="agility" title="d6 Agility Roll">
                            <i class="fas fa-dice-d6"></i>
                        </a>
                    </div>
                    <div class="ability-box">
                        <input
                            class="ability-base"
                            type="number"
                            name="system.abilities.agility.base"
                            value="{{ adata.abilities.agility.base }}"
                            data-dtype="Number" />
                    </div>
                    <div class="item-dice">
                        <a class="ability-d100-roll" data-ability="agility" title="d100 Agility Roll">
                            <i class="fas fa-dice-d20"></i>
                        </a>
                    </div>
                </div>
            </li>
            <li class="ability" data-ability="intelligence">
                <h4 class="ability-name box-title rollable">Intelligence</h4>
                <h3 class="ability-value">{{ adata.abilities.intelligence.effective }}</h3>
                <div class="ability-modifiers flexrow">
                    <div class="item-dice">
                        <a class="ability-d6-roll" data-ability="intelligence" title="d6 Intelligence Roll">
                            <i class="fas fa-dice-d6"></i>
                        </a>
                    </div>
                    <div class="ability-box">
                        <input
                            class="ability-base"
                            type="number"
                            name="system.abilities.intelligence.base"
                            value="{{ adata.abilities.intelligence.base }}"
                            data-dtype="Number" />
                    </div>
                    <div class="item-dice">
                        <a class="ability-d100-roll" data-ability="intelligence" title="d100 Intelligence Roll">
                            <i class="fas fa-dice-d20"></i>
                        </a>
                    </div>
                </div>
            </li>
            <li class="ability" data-ability="aura">
                <h4 class="ability-name box-title rollable">Aura</h4>
                <h3 class="ability-value">{{ adata.abilities.aura.effective }}</h3>
                <div class="ability-modifiers flexrow">
                    <div class="item-dice">
                        <a class="ability-d6-roll" data-ability="aura" title="d6 Aura Roll">
                            <i class="fas fa-dice-d6"></i>
                        </a>
                    </div>
                    <div class="ability-box">
                        <input
                            class="ability-base"
                            type="number"
                            name="system.abilities.aura.base"
                            value="{{ adata.abilities.aura.base }}"
                            data-dtype="Number" />
                    </div>
                    <div class="item-dice">
                        <a class="ability-d100-roll" data-ability="aura" title="d100 Aura Roll">
                            <i class="fas fa-dice-d20"></i>
                        </a>
                    </div>
                </div>
            </li>
            <li class="ability" data-ability="will">
                <h4 class="ability-name box-title rollable">Will</h4>
                <h3 class="ability-value">{{ adata.abilities.will.effective }}</h3>
                <div class="ability-modifiers flexrow">
                    <div class="item-dice">
                        <a class="ability-d6-roll" data-ability="will" title="d6 Will Roll">
                            <i class="fas fa-dice-d6"></i>
                        </a>
                    </div>
                    <div class="ability-box">
                        <input
                            class="ability-base"
                            type="number"
                            name="system.abilities.will.base"
                            value="{{ adata.abilities.will.base }}"
                            data-dtype="Number" />
                    </div>
                    <div class="item-dice">
                        <a class="ability-d100-roll" data-ability="will" title="d100 Will Roll">
                            <i class="fas fa-dice-d20"></i>
                        </a>
                    </div>
                </div>
            </li>
        </ul>
        <ul class="flexrow ability-scores">
            <li class="ability" data-ability="eyesight">
                <h4 class="ability-name box-title rollable">Eyesight</h4>
                <h3 class="ability-value">{{ adata.abilities.eyesight.effective }}</h3>
                <div class="ability-modifiers flexrow">
                    <div class="item-dice">
                        <a class="ability-d6-roll" data-ability="eyesight" title="d6 Eyesight Roll">
                            <i class="fas fa-dice-d6"></i>
                        </a>
                    </div>
                    <div class="ability-box">
                        <input
                            class="ability-base"
                            type="number"
                            name="system.abilities.eyesight.base"
                            value="{{ adata.abilities.eyesight.base }}"
                            data-dtype="Number" />
                    </div>
                    <div class="item-dice">
                        <a class="ability-d100-roll" data-ability="eyesight" title="d100 Eyesight Roll">
                            <i class="fas fa-dice-d20"></i>
                        </a>
                    </div>
                </div>
            </li>
            <li class="ability" data-ability="hearing">
                <h4 class="ability-name box-title rollable">Hearing</h4>
                <h3 class="ability-value">{{ adata.abilities.hearing.effective }}</h3>
                <div class="ability-modifiers flexrow">
                    <div class="item-dice">
                        <a class="ability-d6-roll" data-ability="hearing" title="d6 Hearing Roll">
                            <i class="fas fa-dice-d6"></i>
                        </a>
                    </div>
                    <div class="ability-box">
                        <input
                            class="ability-base"
                            type="number"
                            name="system.abilities.hearing.base"
                            value="{{ adata.abilities.hearing.base }}"
                            data-dtype="Number" />
                    </div>
                    <div class="item-dice">
                        <a class="ability-d100-roll" data-ability="hearing" title="d100 Hearing Roll">
                            <i class="fas fa-dice-d20"></i>
                        </a>
                    </div>
                </div>
            </li>
            <li class="ability" data-ability="smell">
                <h4 class="ability-name box-title rollable">Smell</h4>
                <h3 class="ability-value">{{ adata.abilities.smell.effective }}</h3>
                <div class="ability-modifiers flexrow">
                    <div class="item-dice">
                        <a class="ability-d6-roll" data-ability="smell" title="d6 Smell Roll">
                            <i class="fas fa-dice-d6"></i>
                        </a>
                    </div>
                    <div class="ability-box">
                        <input
                            class="ability-base"
                            type="number"
                            name="system.abilities.smell.base"
                            value="{{ adata.abilities.smell.base }}"
                            data-dtype="Number" />
                    </div>
                    <div class="item-dice">
                        <a class="ability-d100-roll" data-ability="smell" title="d100 Smell Roll">
                            <i class="fas fa-dice-d20"></i>
                        </a>
                    </div>
                </div>
            </li>
            <li class="ability" data-ability="voice">
                <h4 class="ability-name box-title rollable">Voice</h4>
                <h3 class="ability-value">{{ adata.abilities.voice.effective }}</h3>
                <div class="ability-modifiers flexrow">
                    <div class="item-dice">
                        <a class="ability-d6-roll" data-ability="voice" title="d6 Voice Roll">
                            <i class="fas fa-dice-d6"></i>
                        </a>
                    </div>
                    <div class="ability-box">
                        <input
                            class="ability-base"
                            type="number"
                            name="system.abilities.voice.base"
                            value="{{ adata.abilities.voice.base }}"
                            data-dtype="Number" />
                    </div>
                    <div class="item-dice">
                        <a class="ability-d100-roll" data-ability="voice" title="d100 Voice Roll">
                            <i class="fas fa-dice-d20"></i>
                        </a>
                    </div>
                </div>
            </li>
            <li class="ability" data-ability="comeliness">
                <h4 class="ability-name box-title rollable">Comeliness</h4>
                <h3 class="ability-value">{{ adata.abilities.comeliness.effective }}</h3>
                <div class="ability-modifiers flexrow">
                    <div class="item-dice">
                        <a class="ability-d6-roll" data-ability="comeliness" title="d6 Comeliness Roll">
                            <i class="fas fa-dice-d6"></i>
                        </a>
                    </div>
                    <div class="ability-box">
                        <input
                            class="ability-base"
                            type="number"
                            name="system.abilities.comeliness.base"
                            value="{{ adata.abilities.comeliness.base }}"
                            data-dtype="Number" />
                    </div>
                    <div class="item-dice">
                        <a class="ability-d100-roll" data-ability="comeliness" title="d100 Comeliness Roll">
                            <i class="fas fa-dice-d20"></i>
                        </a>
                    </div>
                </div>
            </li>
            <li class="ability" data-ability="morality">
                <h4 class="ability-name box-title rollable">Morality</h4>
                <h3 class="ability-value">{{ adata.abilities.morality.effective }}</h3>
                <div class="ability-modifiers flexrow">
                    <div class="item-dice">
                        <a class="ability-d6-roll" data-ability="morality" title="d6 Morality Roll">
                            <i class="fas fa-dice-d6"></i>
                        </a>
                    </div>
                    <div class="ability-box">
                        <input
                            class="ability-base"
                            type="number"
                            name="system.abilities.morality.base"
                            value="{{ adata.abilities.morality.base }}"
                            data-dtype="Number" />
                    </div>
                    <div class="item-dice">
                        <a class="ability-d100-roll" data-ability="morality" title="d100 Morality Roll">
                            <i class="fas fa-dice-d20"></i>
                        </a>
                    </div>
                </div>
            </li>
        </ul>
        <div class="profile-params">
            <div class="flexrow profile-item">
                <div class="attribute sunsign flexrow">
                    <label for="system.sunsign" class="label">Sunsign</label>
                    {{#if customSunSign}}
                    <input
                        class="value"
                        type="text"
                        id="system.sunsign"
                        name="system.sunsign"
                        value="{{ adata.sunsign }}"
                        data-dtype="String" />
                    {{else}}
                    <select class="value" id="system.sunsign" name="system.sunsign" data-dtype="String">
                        {{selectOptions config.sunsigns selected=adata.sunsign valueAttr="key" labelAttr="key"}}
                    </select>
                    {{/if}}
                </div>
                <div class="attribute species flexrow">
                    <label for="system.species" class="label">Race</label>
                    <input
                        class="value"
                        type="text"
                        id="system.species"
                        name="system.species"
                        value="{{ adata.species }}"
                        data-dtype="String" />
                </div>
                <div class="attribute gender flexrow">
                    <label for="system.gender" class="label">Gender</label>
                    <select class="value" id="system.gender" name="system.gender">
                        {{selectOptions config.gender selected=adata.gender valueAttr="key" labelAttr="key"}}
                    </select>
                </div>
            </div>
        </div>
        <div class="flexrow items traits">
            <ol class="items-list traits-list">
                <li class="items-header trait flexrow">
                    <h3 class="item-name trait-name">
                        Physical Traits
                        <a class="more-info" data-journal-entry="Sheet - Profile Tab">
                            <i class="far fa-question-circle"></i>
                        </a>
                    </h3>
                    <div class="trait-notes item-detail">Notes</div>
                    <div class="item-controls">
                        <a
                            class="item-control item-create active"
                            title="Create Physical Trait"
                            data-type="trait"
                            data-traittype="Physical">
                            <i class="fas fa-plus"></i>
                            Add
                        </a>
                    </div>
                </li>
                <ol class="item-list trait-list">
                    {{#each items as |item|}}
                    {{#if (and (eq item.type "trait") (eq item.system.type "Physical"))}}
                    <li class="item trait trait-item flexrow" data-item-id="{{ item.id }}" data-item-name="{{ item.name }}">
                        <div class="item-name trait-name flexrow">
                            <div class="item-image" style="background-image: url('{{ item.img }}')"></div>
                            <h4>{{ item.name }}</h4>
                        </div>
                        <div class="trait-notes">{{ item.system.notes }}</div>
                        <div class="item-controls">
                            <a class="item-control item-edit" title="Edit Trait">
                                <i class="active fas fa-edit"></i>
                            </a>
                            <a class="item-control item-delete" title="Delete Trait" data-label="Physical Trait">
                                <i class="active fas fa-trash"></i>
                            </a>
                        </div>
                    </li>
                    {{/if}}
                    {{/each}}
                </ol>
            </ol>
            <ol class="items-list traits-list">
                <li class="items-header trait flexrow">
                    <h3 class="item-name trait-name">
                        Psyche Traits
                        <a class="more-info" data-journal-entry="Sheet - Profile Tab">
                            <i class="far fa-question-circle"></i>
                        </a>
                    </h3>
                    <div class="trait-notes item-detail">Notes</div>
                    <div class="item-controls">
                        <a class="item-control item-create active" title="Create Psyche Trait" data-type="trait" data-traittype="Psyche">
                            <i class="fas fa-plus"></i>
                            Add
                        </a>
                    </div>
                </li>
                <ol class="item-list trait-list">
                    {{#each items as |item|}}
                    {{#if (and (eq item.type "trait") (eq item.system.type "Psyche"))}}
                    <li class="item trait trait-item flexrow" data-item-id="{{ item.id }}" data-item-name="{{ item.name }}">
                        <div class="item-name trait-name flexrow">
                            <div class="item-image" style="background-image: url('{{ item.img }}')"></div>
                            <h4>{{ item.psycheName }}</h4>
                        </div>
                        <div class="trait-notes">{{ item.system.notes }}</div>
                        <div class="item-controls">
                            <a class="item-control item-edit" title="Edit Trait">
                                <i class="active fas fa-edit"></i>
                            </a>
                            <a class="item-control item-delete" title="Delete Trait" data-label="Psyche Trait">
                                <i class="active fas fa-trash"></i>
                            </a>
                        </div>
                    </li>
                    {{/if}}
                    {{/each}}
                </ol>
            </ol>
        </div>
        <div class="flexcol">
            <div class="profile-desc flexcol">
                <h3 class="label">
                    Biography
                    <a class="more-info" data-journal-entry="Sheet - Profile Tab">
                        <i class="far fa-question-circle"></i>
                    </a>
                </h3>
                <div class="description">
                    {{editor adata.biography target="system.biography" button=true owner=owner editable=editable}}
                </div>
            </div>
        </div>
    </div>
</div>

{{!-- Skills Tab --}}
<div class="tab skills items" data-group="primary" data-tab="skills">
    <div class="flexrow">
        <input
            class="skill-name-filter"
            type="text"
            name="system.skillNameFilter"
            placeholder="Filter skills by name..."
            data-dtype="String" />
    </div>
    {{> char_skill_list_partial skillType='Physical' skills=physicalSkills}}
    {{> char_skill_list_partial skillType='Communication' skills=communicationSkills}}
    {{> char_skill_list_partial skillType='Combat' skills=combatSkills}}
    {{> char_skill_list_partial skillType='Craft' skills=craftSkills}}
    {{> char_skill_list_partial skillType='Magic' skills=magicSkills}}
    {{> char_skill_list_partial skillType='Ritual' skills=ritualSkills}}
</div>

{{!-- Combat Tab --}}
<div class="tab combat items" data-group="primary" data-tab="combat">
    <div class="items-list">
        <div class="items-header flexrow">
            <h3 class="item-name">
                Combat Statistics
                <a class="more-info" data-journal-entry="Sheet - Combat Tab">
                    <i class="far fa-question-circle"></i>
                </a>
            </h3>
        </div>
    </div>
    <div class="items-list combat-stats grid grid-fixed-row grid-5col">
        <div class="combat-stat flexrow" id="combat-stat-fatigue">
            <div class="item-dice"></div>
            <label for="system.fatigue" class="combat-stat-label">Fatigue</label>
            <input
                class="combat-fatigue-input"
                type="number"
                min="0"
                id="system.fatigue"
                name="system.fatigue"
                value="{{ adata.fatigue }}"
                data-dtype="Number" />
        </div>
        <div class="combat-stat flexrow" id="combat-stat-initiative">
            <div class="item-dice"></div>
            <label class="combat-stat-label">Init.</label>
            <div class="combat-stat-value">{{ adata.initiative }}</div>
        </div>
        <div class="combat-stat flexrow" id="combat-stat-dodge">
            <div class="item-dice">
                <i class="active fas fa-dice-d20"></i>
            </div>
            <label class="combat-stat-label">
                <a class="dodge-roll" title="Dodge Roll">Dodge</a>
            </label>
            <div class="combat-stat-value">{{ adata.dodge }}</div>
        </div>
        <div class="combat-stat flexrow" id="combat-stat-encumbrance">
            <div class="item-dice"></div>
            <label class="combat-stat-label">Encumb.</label>
            <div class="combat-stat-value">{{ adata.encumbrance }}</div>
        </div>
        <div class="combat-stat flexrow" id="combat-stat-endurance">
            <div class="item-dice"></div>
            <label class="combat-stat-label">Endur.</label>
            <div class="combat-stat-value">{{ adata.endurance }}</div>
        </div>
    </div>
    <div class="items-list combat-stats grid grid-fixed-row {{#if isGM}}grid-7col{{else}}grid-6col{{/if}}">
        <div class="combat-stat flexrow" id="combat-injuryroll">
            <div class="item-dice">
                <i class="active fas fa-dice-d20"></i>
            </div>
            <label class="combat-stat-label tooltip">
                <a class="injury-roll" title="Injury Roll">Injury</a>
                <span class="tooltiptext">Calculate my hit location and injury level</span>
            </label>
        </div>
        <div class="combat-stat flexrow" id="combat-shockroll">
            <div class="item-dice">
                <i class="active fas fa-dice-d20"></i>
            </div>
            <label class="combat-stat-label">
                <a class="shock-roll" title="Shock Roll">Shock</a>
            </label>
        </div>
        <div class="combat-stat flexrow" id="combat-stumbleroll">
            <div class="item-dice">
                <i class="active fas fa-dice-d20"></i>
            </div>
            <label class="combat-stat-label">
                <a class="stumble-roll" title="Stumble Roll">Stumble</a>
            </label>
        </div>
        <div class="combat-stat flexrow" id="combat-fumbleroll">
            <div class="item-dice">
                <i class="active fas fa-dice-d20"></i>
            </div>
            <label class="combat-stat-label">
                <a class="fumble-roll" title="Fumble Roll">Fumble</a>
            </label>
        </div>
        <div class="combat-stat flexrow" id="combat-damageroll">
            <div class="item-dice">
                <i class="active fas fa-dice-d20"></i>
            </div>
            <label class="combat-stat-label tooltip">
                <a class="damage-roll" title="Damage Roll">Damage</a>
            </label>
        </div>
        <div class="combat-stat flexrow" id="combat-fallingroll">
            <div class="item-dice">
                <i class="active fas fa-dice-d20"></i>
            </div>
            <label class="combat-stat-label tooltip">
                <a class="falling-roll" title="Falling Roll">Falling</a>
            </label>
        </div>
        {{#if isGM}}
        <div class="combat-stat flexrow" id="combat-moraleroll">
            <div class="item-dice">
                <i class="active fas fa-dice-d20"></i>
            </div>
            <label class="combat-stat-label tooltip">
                <a class="morale-roll" title="Morale Roll">Morale</a>
            </label>
        </div>
        {{/if}}
    </div>
    {{#if hasSteed}}
    <div class="items-list combat-stats grid grid-fixed-row grid-5col">
        {{#if (not adata.mounted)}}
        <div class="combat-stat flexrow" id="combat-mount">
            <div class="item-dice"></div>
            <label class="combat-stat-label tooltip">
                <a class="mount-action" title="Mount">Mount</a>
            </label>
        </div>
        {{else}}
        <div class="combat-stat flexrow" id="combat-dismount">
            <div class="item-dice"></div>
            <label class="combat-stat-label tooltip">
                <a class="mount-action" title="Dismount">Dismount</a>
            </label>
        </div>
        {{/if}}
        <div class="combat-stat flexrow" id="combat-steedcommandroll">
            <div class="item-dice">
                <i class="active fas fa-dice-d20"></i>
            </div>
            <label class="combat-stat-label tooltip">
                <a class="steedcommand-roll{{#unless adata.mounted}} disabled{{/unless}}" title="Steed Command Check">Steed Command</a>
            </label>
        </div>
        <div class="combat-stat flexrow" id="combat-unhorsingroll">
            <div class="item-dice">
                <i class="active fas fa-dice-d20"></i>
            </div>
            <label class="combat-stat-label tooltip">
                <a class="unhorsing-roll{{#unless adata.mounted}} disabled{{/unless}}" title="Unhorsing Roll">Unhorsing</a>
            </label>
        </div>
    </div>
    {{/if}}

    <!-- Weapons -->
    <ol class="items-list weapons-list">
        <li class="items-header weapon flexrow">
            <h3 class="item-name weapon-name">
                Melee Weapons
                <a class="more-info" data-journal-entry="Sheet - Combat Tab">
                    <i class="far fa-question-circle"></i>
                </a>
            </h3>
            <div class="item-detail weapon-qty">Qty</div>
            <div class="item-detail weapon-skill">Skill</div>
            <div class="item-detail weapon-quality">WQ</div>
            <div class="item-detail weapon-atkdef">A/D</div>
            <div class="item-detail weapon-atkmod">Mod</div>
            <div class="item-detail weapon-blunt">B</div>
            <div class="item-detail weapon-edged">E</div>
            <div class="item-detail weapon-piercing">P</div>
            <div class="item-detail weapon-attack">AML</div>
            <div class="item-detail weapon-defense">DML</div>
            <div class="item-detail weapon-notes">Notes</div>
        </li>
        <ol class="item-list weapon-list">
            {{#each items as | item |}}
            {{#if (and (eq item.type "weapongear") system.isEquipped)}}
            <li
                class="item weapon {{#unless system.isCarried}}nocarry{{/unless}} flexrow"
                data-item-id="{{ item.id }}"
                data-item-name="{{ item.name }}">
                <div class="item-name weapon-name {{#if (and system.isEquipped system.isCarried)}}melee-weapon-attack{{/if}} flexrow">
                    <div class="item-image" style="background-image: url('{{ item.img }}')"></div>
                    <h4>{{ item.name }}</h4>
                </div>
                <div class="item-detail weapon-qty">{{ system.quantity }}</div>
                <div class="item-detail weapon-skill">{{ system.assocSkill }}</div>
                <div class="item-detail weapon-quality">{{ item.wq }}</div>
                <div class="item-detail weapon-atkdef">{{ system.attack }}/{{ system.defense }}</div>
                <div class="item-detail weapon-atkmod">{{ system.attackModifier }}</div>
                {{#if (lt system.blunt 0)}}
                <div class="item-detail weapon-blunt"><i class="fas fa-times"></i></div>
                {{else}}
                <div class="item-detail weapon-blunt {{#if (and system.isEquipped system.isCarried)}}active{{/if}}">
                    {{#if (and system.isEquipped system.isCarried)}}
                    <a
                        class="weapon-damage-roll"
                        title="{{ item.name }} Blunt Damage Roll"
                        data-weapon="{{ item.name }}"
                        data-aspect="Blunt">
                        {{ system.blunt }}
                    </a>
                    {{else}}{{ system.blunt }}{{/if}}
                </div>
                {{/if}}
                {{#if (lt system.edged 0)}}
                <div class="item-detail weapon-edged"><i class="fas fa-times"></i></div>
                {{else}}
                <div class="item-detail weapon-edged {{#if (and system.isEquipped system.isCarried)}}active{{/if}}">
                    {{#if (and system.isEquipped system.isCarried)}}
                    <a
                        class="weapon-damage-roll"
                        title="{{ item.name }} Edged Damage Roll"
                        data-weapon="{{ item.name }}"
                        data-aspect="Edged">
                        {{ system.edged }}
                    </a>
                    {{else}}{{ system.edged }}{{/if}}
                </div>
                {{/if}}
                {{#if (lt system.piercing 0)}}
                <div class="item-detail weapon-piercing"><i class="fas fa-times"></i></div>
                {{else}}
                <div class="item-detail weapon-piercing {{#if (and system.isEquipped system.isCarried)}}active{{/if}}">
                    {{#if (and system.isEquipped system.isCarried)}}
                    <a
                        class="weapon-damage-roll"
                        title="{{ item.name }} Piercing Damage Roll"
                        data-weapon="{{ item.name }}"
                        data-aspect="Piercing">
                        {{ system.piercing }}
                    </a>
                    {{else}}{{ system.piercing }}{{/if}}
                </div>
                {{/if}}
                <div class="item-detail weapon-attack {{#if (and system.isEquipped system.isCarried)}}active{{/if}}">
                    {{#if (and system.isEquipped system.isCarried)}}
                    <a class="weapon-attack-roll" title="{{ item.name }} Attack Roll">
                        {{ system.attackMasteryLevel }}
                    </a>
                    {{else}}
                    {{ system.attackMasteryLevel }}
                    {{/if}}
                </div>
                <div class="item-detail weapon-defense {{#if (and system.isEquipped system.isCarried)}}active{{/if}}">
                    {{#if (and system.isEquipped system.isCarried)}}
                    <a class="weapon-defend-roll" title="{{ item.name }} Defense Roll">
                        {{ system.defenseMasteryLevel }}
                    </a>
                    {{else}}{{ system.defenseMasteryLevel }}{{/if}}
                </div>
                <div class="item-detail weapon-notes">{{ system.notes }}</div>
            </li>
            {{/if}}
            {{/each}}
        </ol>
    </ol>

    <!-- Missiles -->
    <ol class="items-list missiles-list">
        <li class="items-header missile flexrow">
            <h3 class="item-name missile-name">
                Missile Weapons
                <a class="more-info" data-journal-entry="Sheet - Combat Tab">
                    <i class="far fa-question-circle"></i>
                </a>
            </h3>
            <div class="item-detail missile-qty">Qty</div>
            <div class="item-detail missile-skill">Skill</div>
            <div class="item-detail missile-short">Short</div>
            <div class="item-detail missile-medium">Med</div>
            <div class="item-detail missile-long">Long</div>
            <div class="item-detail missile-extreme">Ext</div>
            <div class="item-detail missile-attack">AML</div>
            <div class="item-detail missile-notes">Notes</div>
        </li>
        <ol class="item-list missile-list">
            {{#each items as | item |}}
            {{#if (and (eq item.type "missilegear") system.isEquipped)}}
            <li
                class="item missile {{#unless system.isCarried}}nocarry{{/unless}} flexrow"
                data-item-id="{{ item.id }}"
                data-item-name="{{ item.name }}">
                <div class="item-name missile-name {{#if (and system.isEquipped system.isCarried)}}missile-weapon-attack{{/if}} flexrow">
                    <div class="item-image" style="background-image: url('{{ item.img }}')"></div>
                    <h4>{{ item.name }}</h4>
                </div>
                <div class="item-detail missile-qty">{{ system.quantity }}</div>
                <div class="item-detail missile-skill">{{ system.assocSkill }}</div>
                {{#if (lt system.range.short 0)}}
                <div class="item-detail missile-short"><i class="fas fa-times"></i></div>
                {{else}}
                <div class="item-detail missile-short {{#if (and system.isEquipped system.isCarried)}}active{{/if}}">
                    {{#if (and system.isEquipped system.isCarried)}}
                    <a
                        class="missile-damage-roll"
                        title="{{ item.name }} Short-Range Damage Roll"
                        data-weapon="{{ item.name }}"
                        data-range="Short">
                        {{#if ../isGridDistanceUnits}}{{ system.rangeGrid.short }}{{else}} {{ system.range.short }}{{/if}}/{{
                            system.impact.short
                        }}
                    </a>
                    {{else}}
                    {{ system.range.short }}/{{ system.impact.short }}
                    {{/if}}
                </div>
                {{/if}}
                {{#if (lt system.range.medium 0)}}
                <div class="item-detail missile-medium"><i class="fas fa-times"></i></div>
                {{else}}
                <div class="item-detail missile-medium {{#if (and system.isEquipped system.isCarried)}}active{{/if}}">
                    {{#if (and system.isEquipped system.isCarried)}}
                    <a
                        class="missile-damage-roll"
                        title="{{ item.name }} Medium-Range Damage Roll"
                        data-weapon="{{ item.name }}"
                        data-range="Medium">
                        {{#if ../isGridDistanceUnits}}{{ system.rangeGrid.medium }}{{else}}{{ system.range.medium }}{{/if}}/{{
                            system.impact.medium
                        }}
                    </a>
                    {{else}}
                    {{ system.range.medium }}/{{ system.impact.medium }}
                    {{/if}}
                </div>
                {{/if}}
                {{#if (lt system.range.long 0)}}
                <div class="item-detail missile-long"><i class="fas fa-times"></i></div>
                {{else}}
                <div class="item-detail missile-long {{#if (and system.isEquipped system.isCarried)}}active{{/if}}">
                    {{#if (and system.isEquipped system.isCarried)}}
                    <a
                        class="missile-damage-roll"
                        title="{{ item.name }} Long-Range Damage Roll"
                        data-weapon="{{ item.name }}"
                        data-range="Long">
                        {{#if ../isGridDistanceUnits}}{{ system.rangeGrid.long }}{{else}}{{ system.range.long }}{{/if}}/{{
                            system.impact.long
                        }}
                    </a>
                    {{else}}
                    {{ system.range.long }}/{{ system.impact.long }}
                    {{/if}}
                </div>
                {{/if}}
                {{#if (lt system.range.extreme 0)}}
                <div class="item-detail missile-extreme"><i class="fas fa-times"></i></div>
                {{else}}
                <div class="item-detail missile-extreme {{#if (and system.isEquipped system.isCarried)}}active{{/if}}">
                    {{#if (and system.isEquipped system.isCarried)}}
                    <a
                        class="missile-damage-roll"
                        title="{{ item.name }} Extreme-Range Damage Roll"
                        data-weapon="{{ item.name }}"
                        data-range="Extreme">
                        {{#if ../isGridDistanceUnits}}{{ system.rangeGrid.extreme }}{{else}}{{ system.range.extreme }}{{/if}}/{{
                            system.impact.extreme
                        }}
                    </a>
                    {{else}}
                    {{ system.range.extreme }}/{{ system.impact.extreme }}
                    {{/if}}
                </div>
                {{/if}}
                <div class="item-detail missile-attack {{#if (and system.isEquipped system.isCarried)}}active{{/if}}">
                    {{#if (and system.isEquipped system.isCarried)}}
                    <a class="missile-attack-roll" title="Missile Attack Roll">
                        {{ system.attackMasteryLevel }}
                    </a>
                    {{else}}
                    {{ system.attackMasteryLevel }}{{/if}}
                </div>
                <div class="item-detail missile-notes">{{ system.notes }}</div>
            </li>
            {{/if}}
            {{/each}}
        </ol>
    </ol>

    <!-- Esoteric Attacks -->
    {{#if hasEsotericAtk}}
    <ol class="items-list missiles-list">
        <li class="items-header missile flexrow">
            <h3 class="item-name missile-name">
                Esoteric Attacks
                <a class="more-info" data-journal-entry="Sheet - Combat Tab">
                    <i class="far fa-question-circle"></i>
                </a>
            </h3>
            <div class="item-detail missile-attack">EML</div>
            <div class="item-detail missile-short">Range</div>
            <div class="item-detail missile-notes">Notes</div>
        </li>
        <ol class="item-list missile-list">
            {{#each esotericAtkOptions as |item id|}}
            <li class="item missile flexrow" data-item-id="{{ item._id }}" data-item-name="{{ system.name }}">
                <div class="item-name missile-name esoteric-attack flexrow">
                    <div class="item-image" style="background-image: url('{{ item.img }}')"></div>
                    <h4>{{ item.name }}</h4>
                </div>
                <div class="item-detail missile-attack">{{ system.effectiveMasteryLevel }}</div>
                <div class="item-detail missile-short">{{ system.masteryLevel }} ft</div>
                <div class="item-detail missile-notes">{{ system.notes }}</div>
            </li>
            {{/each}}
        </ol>
    </ol>
    {{/if}}

    <!-- Injuries -->
    <ol class="items-list injuries-list">
        <li class="items-header injury flexrow">
            <h3 class="item-name injury-name">
                Injuries
                <a class="more-info" data-journal-entry="Sheet - Combat Tab">
                    <i class="far fa-question-circle"></i>
                </a>
            </h3>
            <div class="item-detail injury-healrate">HR</div>
            <div class="item-detail injury-severity">IL</div>
            <div class="item-detail injury-notes">Notes</div>
            <div class="item-controls">
                <a class="item-control item-create active" title="Create Injury" data-type="injury">
                    <i class="fas fa-plus"></i>
                    Add
                </a>
            </div>
        </li>
        <ol class="item-list injury-list">
            {{#each items as | item |}}
            {{#if (eq item.type "injury")}}
            <li class="item injury flexrow" data-item-id="{{ item.id }}" data-item-name="{{ item.name }}">
                <div class="item-name injury-name flexrow">
                    <h4>{{ item.name }}</h4>
                </div>
                <div class="item-detail injury-healrate active">
                    <a class="healing-roll" title="{{ item.name }} Healing Roll">
                        {{#if (gt system.healRate 6)}}EE{{else}}{{ system.healRate }}{{/if}}
                    </a>
                </div>
                <div class="item-detail injury-severity">{{ system.severity }}</div>
                <div class="item-detail injury-notes">{{ system.notes }}</div>
                <div class="item-controls">
                    <a class="item-control item-edit" title="Edit Injury">
                        <i class="active fas fa-edit"></i>
                    </a>
                    <a class="item-control item-delete" title="Delete Injury" data-label="Injury">
                        <i class="active fas fa-trash"></i>
                    </a>
                </div>
            </li>
            {{/if}}
            {{/each}}
        </ol>
    </ol>

    <!-- Locations -->
    <ol class="items-list armorlocations-list">
        <li class="items-header armorlocation flexrow">
            <h3 class="item-name armorlocation-name">
                Armor Locations
                <a class="more-info" data-journal-entry="Sheet - Combat Tab">
                    <i class="far fa-question-circle"></i>
                </a>
            </h3>
            <div class="item-detail armorlocation-layers">Layers</div>
            <div class="item-detail armorlocation-blunt">B</div>
            <div class="item-detail armorlocation-edged">E</div>
            <div class="item-detail armorlocation-piercing">P</div>
            <div class="item-detail armorlocation-fire">F</div>
            <div class="item-detail armorlocation-prob">High</div>
            <div class="item-detail armorlocation-prob">Mid</div>
            <div class="item-detail armorlocation-prob">Low</div>
            <div class="item-detail armorlocation-notes">Notes</div>
            <div class="item-controls">
                <a class="item-control item-create active" title="Create Location" data-type="armorlocation">
                    <i class="fas fa-plus"></i>
                    Add
                </a>
            </div>
        </li>
        <ol class="item-list armorlocation-list">
            {{#each items as | item |}}
            {{#if (eq item.type "armorlocation")}}
            <li class="item armorlocation flexrow" data-item-id="{{ item.id }}" data-item-name="{{ item.name }}">
                <div class="item-name armorlocation-name flexrow">
                    <h4>{{ item.name }}</h4>
                </div>
                <div class="item-detail armorlocation-layers">{{ system.layers }}</div>
                <div class="item-detail armorlocation-blunt">{{ system.blunt }}</div>
                <div class="item-detail armorlocation-edged">{{ system.edged }}</div>
                <div class="item-detail armorlocation-piercing">{{ system.piercing }}</div>
                <div class="item-detail armorlocation-fire">{{ system.fire }}</div>
                <div class="item-detail armorlocation-prob">{{ probHigh }}%</div>
                <div class="item-detail armorlocation-prob">{{ probMid }}%</div>
                <div class="item-detail armorlocation-prob">{{ probLow }}%</div>
                <div class="item-detail armorlocation-notes">{{ system.notes }}</div>
                <div class="item-controls">
                    <a class="item-control item-edit" title="Edit Location">
                        <i class="active fas fa-edit"></i>
                    </a>
                    <a class="item-control item-delete" title="Delete Location" data-label="Location">
                        <i class="active fas fa-trash"></i>
                    </a>
                </div>
            </li>
            {{/if}}
            {{/each}}
        </ol>
    </ol>
</div>

{{/char_layout_partial}}
